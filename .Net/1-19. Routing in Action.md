## Tổng quan về MVC: Controller, Action và View trong ASP.NET Core

### Mục tiêu
- Hiểu cách hoạt động của **kiến trúc MVC (Model-View-Controller)** trong ASP.NET Core.
- Xác định **controller**, **action** và **ID** từ URL.
- Nắm rõ cách tổ chức thư mục và đặt tên trong dự án MVC.
- Hiểu cách định tuyến (routing) và trả về view từ controller.

---

### 1. Cấu trúc thư mục trong dự án MVC
- Dự án MVC bao gồm ba thư mục chính:
  - **Controllers**: Chứa các file controller, ví dụ: `HomeController.cs`.
  - **Models**: Chứa các class định nghĩa dữ liệu, ví dụ: `ErrorViewModel.cs`.
  - **Views**: Chứa các file giao diện (view) với định dạng `.cshtml`, được tổ chức theo tên controller.
- **Quy tắc đặt tên**:
  - Tên controller phải có hậu tố `Controller` (ví dụ: `HomeController`) và nằm trong thư mục `Controllers`.
  - Thư mục con trong `Views` phải có tên trùng với tên controller (không bao gồm hậu tố `Controller`), ví dụ: thư mục `Home` cho `HomeController`.
  - Các view trong thư mục `Views/Home` tương ứng với các action của `HomeController`, ví dụ: `Index.cshtml`, `Privacy.cshtml`.

---

### 2. Controller và Action
- **Controller**: 
  - Là một class xử lý các yêu cầu HTTP, ví dụ: `HomeController`.
  - Chứa các **action method** (phương thức hành động) để xử lý logic và trả về kết quả.
- **Action**: 
  - Là các phương thức trong controller, thường trả về một **IActionResult** (kết quả hành động).
  - Ví dụ: `Index()`, `Privacy()` trong `HomeController`.
- **Quy tắc trả về view**:
  - Nếu không chỉ định tên view trong `return View()`, hệ thống sẽ tìm view có tên trùng với action trong thư mục `Views/[Tên Controller]`.
  - Ví dụ: `return View()` trong action `Index` sẽ tìm file `Views/Home/Index.cshtml`.
  - Có thể chỉ định tên view cụ thể, ví dụ: `return View("Privacy")` để trả về `Privacy.cshtml` thay vì view mặc định.

---

### 3. Định tuyến (Routing)
- **Cấu trúc URL**:
  - URL trong ASP.NET Core thường có dạng: `/{controller}/{action}/{id?}`.
  - Ví dụ: `/Home/Privacy`:
    - **Controller**: `HomeController` (tên controller là `Home`).
    - **Action**: `Privacy` (phương thức `Privacy()` trong `HomeController`).
    - **ID**: Không bắt buộc, thường là tham số bổ sung (nếu có).
  - Nếu URL trống (ví dụ: `/`), hệ thống sử dụng **định tuyến mặc định**:
    - Mặc định: `HomeController` và action `Index`.
    - Có thể thay đổi trong file `Program.cs` (ví dụ: đặt mặc định là `Home/Privacy`).
- **Cách hoạt động**:
  - Khi nhận yêu cầu, hệ thống ánh xạ URL đến controller và action tương ứng.
  - Action method được gọi, thực thi logic và trả về view tương ứng.

---

### 4. Ví dụ minh họa
- **URL**: `/Home/Index`
  - **Controller**: `HomeController`.
  - **Action**: `Index`.
  - **View trả về**: `Views/Home/Index.cshtml`.
  - Nội dung: Hiển thị trang chủ với văn bản "Welcome" và liên kết đến tài liệu ASP.NET Core.
- **URL**: `/Home/Privacy`
  - **Controller**: `HomeController`.
  - **Action**: `Privacy`.
  - **View trả về**: `Views/Home/Privacy.cshtml`.
  - Nội dung: Hiển thị trang chính sách bảo mật với văn bản trong thẻ `<p>`.

- **Ghi chú**:
  - Nếu thay đổi `return View("Privacy")` trong action `Index`, hệ thống sẽ trả về `Privacy.cshtml` thay vì `Index.cshtml`.
  - Định tuyến mặc định có thể được cấu hình trong `Program.cs` để thay đổi hành vi khi URL không chỉ định controller/action.

---

### 5. Gỡ lỗi (Debugging)
- **Cách sử dụng**:
  - Trong Visual Studio, đặt **breakpoint** (điểm dừng) tại dòng code trong action method.
  - Khi chạy ứng dụng, nếu URL gọi đúng action (ví dụ: `/Home/Index`), breakpoint sẽ được kích hoạt, cho phép kiểm tra luồng thực thi.
- **Ví dụ**:
  - Đặt breakpoint trong `Index()` và `Privacy()` của `HomeController`.
  - Truy cập `/Home/Index` → Breakpoint trong `Index()` được kích hoạt.
  - Truy cập `/Home/Privacy` → Breakpoint trong `Privacy()` được kích hoạt.

---

### 6. Ghi chú thêm
- **Model không bắt buộc**:
  - Không phải mọi action đều cần model. Một số view có thể là tĩnh (static view) và không yêu cầu dữ liệu từ model.
  - Ví dụ: `ErrorViewModel` hiện chỉ là một class đơn giản với hai thuộc tính, không được sử dụng trong các view `Index` hoặc `Privacy`.
- **Tầm quan trọng của kiến trúc MVC**:
  - Tách biệt rõ ràng giữa **Controller** (xử lý logic), **View** (giao diện) và **Model** (dữ liệu).
  - Giúp mã nguồn dễ bảo trì, mở rộng và kiểm thử.
- **Liên kết nội bộ**:
  - Để tìm hiểu thêm về định tuyến, xem [[ASP.NET Core Routing]].
  - Để hiểu về cấu trúc dự án, xem [[Cấu trúc thư mục MVC]].
  - Để tìm hiểu về gỡ lỗi, xem [[Debugging trong Visual Studio]].

---

### 7. Mã nguồn minh họa
```csharp
// HomeController.cs
public class HomeController : Controller
{
    public IActionResult Index()
    {
        return View(); // Trả về Views/Home/Index.cshtml
    }

    public IActionResult Privacy()
    {
        return View(); // Trả về Views/Home/Privacy.cshtml
    }
}
```

```cshtml
<!-- Views/Home/Index.cshtml -->
<h1>Welcome</h1>
<p>Learn about <a href="https://docs.microsoft.com/aspnet/core">building Web apps with ASP.NET Core</a>.</p>
```

```cshtml
<!-- Views/Home/Privacy.cshtml -->
<h1>Privacy Policy</h1>
<p>Use this page to detail your site's privacy policy.</p>
```

---

### 8. Kết luận
- **Controller** điều khiển luồng xử lý yêu cầu, chứa các **action method** để trả về view hoặc dữ liệu.
- **Action** xác định logic cụ thể và view nào sẽ được hiển thị.
- **View** được đặt trong thư mục `Views/[Tên Controller]` và có tên trùng với action (mặc định).
- **Định tuyến** ánh xạ URL đến controller và action, với cấu hình mặc định trong `Program.cs`.
- Hiểu 50-70% nội dung này là một khởi đầu tốt. Khi thực hành, bạn sẽ nắm rõ hơn về sức mạnh của [[Kiến trúc MVC]].