## Seed dữ liệu bảng Category trong Entity Framework Core

### Khái niệm Seed Data
- *Seed data* là việc chèn dữ liệu mẫu ban đầu vào cơ sở dữ liệu (database) khi khởi tạo hoặc cập nhật lược đồ.
- Entity Framework Core hỗ trợ seed data thông qua phương thức `OnModelCreating` của lớp *DbContext*.

### Cách thực hiện Seed dữ liệu Category

- Khi mở trang danh sách category, nếu database chưa có dữ liệu, bạn cần seed một số bản ghi mẫu để hiển thị.
- Thay vì thêm thủ công qua SQL hoặc chức năng "Edit top 200 rows", hãy làm tự động bằng mã nguồn.

#### Các bước thực hiện

1. **Mở lớp ApplicationDbContext**
   - Đây là lớp kế thừa từ `DbContext` đại diện cho kết nối và cấu hình database.

2. **Override phương thức OnModelCreating**
   - Ghi đè (override) phương thức mặc định `OnModelCreating(ModelBuilder modelBuilder)`.
   - Tham số `modelBuilder` dùng để cấu hình các bảng, quan hệ và seed dữ liệu.

3. **Seed dữ liệu cho Category**
   - Sử dụng: `modelBuilder.Entity<Category>().HasData(...)`
   - Tham số của `HasData` là một hoặc nhiều đối tượng *Category*.
   - Ví dụ:

```csharp
protected override void OnModelCreating(ModelBuilder modelBuilder)
{
    base.OnModelCreating(modelBuilder);
    modelBuilder.Entity<Category>().HasData(
        new Category { Id = 1, Name = "Action", DisplayOrder = 1 },
        new Category { Id = 2, Name = "SciFi", DisplayOrder = 2 },
        new Category { Id = 3, Name = "History", DisplayOrder = 3 }
    );
}
```

### Lưu ý khi seed dữ liệu
- Mỗi lần thay đổi dữ liệu seed hoặc cấu trúc bảng, **phải tạo migration mới** để cập nhật database.
- Các bước:
  1. Tạo migration:  
     ```
     Add-Migration SeedCategoryTable
     ```
  2. Cập nhật database:  
     ```
     Update-Database
     ```
- Sau khi chạy xong, bảng `Category` sẽ có 3 bản ghi mẫu: Action, SciFi, History.

### Kiểm tra kết quả
- Làm mới (refresh) bảng Category trong database để kiểm tra dữ liệu đã được seed thành công.

### Ghi chú thêm
- `ModelBuilder` là công cụ mặc định Entity Framework Core cung cấp cho cấu hình mô hình và seed dữ liệu.
- Phương thức `HasData()` cho phép thêm nhiều bản ghi cùng lúc bằng cách truyền vào mảng đối tượng.
- Các thao tác seed dữ liệu chỉ thực hiện khi chạy migration và update database, không tự động chạy mỗi lần ứng dụng khởi động.

---

#### Xem thêm
- [[Entity Framework Core]]
- [[Migration trong EF Core]]
- [[Seed Data]]