# Tổng quan về Docker và Ứng dụng

## Tổng quan về Docker

### Lý do cần sử dụng Docker
- **Vấn đề tương thích**:
  - Các dịch vụ khác nhau (web server, database, messaging system) thường gặp vấn đề tương thích với hệ điều hành (OS) cơ bản.
  - Phiên bản của các dịch vụ có thể không tương thích với OS, dẫn đến việc phải thay đổi OS hoặc dịch vụ.
  - Xung đột phiên bản giữa các thư viện và phụ thuộc (dependencies) của các dịch vụ.
- **Khó khăn trong thiết lập môi trường**:
  - Mỗi khi có nhà phát triển mới, việc thiết lập môi trường phát triển yêu cầu nhiều bước phức tạp và hàng trăm lệnh.
  - Môi trường phát triển, kiểm thử và sản xuất khác nhau, gây khó khăn trong việc đảm bảo ứng dụng hoạt động đồng nhất.
- **Thay đổi linh hoạt**:
  - Khi kiến trúc ứng dụng thay đổi (nâng cấp phiên bản, thay đổi database), cần kiểm tra lại tương thích giữa các thành phần.
  - Docker giúp giải quyết vấn đề này bằng cách đóng gói từng thành phần vào container riêng biệt, độc lập với OS cơ bản.

### Lợi ích của Docker
- **Đóng gói ứng dụng**:
  - Mỗi thành phần (component) chạy trong một container riêng, chứa các thư viện và phụ thuộc riêng, không ảnh hưởng đến nhau.
  - Chỉ cần xây dựng cấu hình Docker một lần, các nhà phát triển có thể khởi chạy container bằng lệnh `docker run`.
- **Tính di động**:
  - Ứng dụng chạy đồng nhất trên mọi môi trường (phát triển, kiểm thử, sản xuất) miễn là có cài Docker.
- **Triển khai nhanh chóng**:
  - Container khởi động nhanh (trong vài giây), nhẹ (dung lượng tính bằng MB), so với máy ảo (VM) cần vài phút và nặng hàng GB.

### Container là gì?
- **Định nghĩa**:
  - Container là môi trường cô lập hoàn toàn, có thể chứa:
    - Các tiến trình/dịch vụ riêng.
    - Giao diện mạng riêng (network interfaces).
    - Điểm gắn kết (mounts) riêng.
  - Tương tự máy ảo (VM), nhưng container chia sẻ nhân (kernel) của hệ điều hành cơ bản.
- **So sánh với máy ảo (VM)**:
  - **Container**:
    - Chia sẻ nhân OS, chỉ chứa phần mềm khác biệt (file managers, compilers, v.v.).
    - Nhẹ, nhanh, kích thước nhỏ (MB), ít cô lập hơn do chia sẻ tài nguyên (như kernel).
  - **Máy ảo**:
    - Chứa toàn bộ OS riêng, nặng (GB), khởi động chậm, cô lập hoàn toàn.
    - Phù hợp để chạy các ứng dụng trên các OS khác nhau (Linux, Windows) trên cùng một hypervisor.
- **Kết hợp container và VM**:
  - Trong môi trường lớn, container thường được triển khai trên các máy ảo chạy Docker host để tận dụng lợi thế của cả hai:
    - VM: Dễ dàng cung cấp hoặc hủy bỏ Docker host.
    - Container: Triển khai ứng dụng nhanh, mở rộng dễ dàng.

### Nhân (Kernel) và Hệ điều hành trong Docker
- **Nhân OS**:
  - Nhân (kernel) tương tác trực tiếp với phần cứng.
  - Các OS như Ubuntu, Fedora, CentOS chia sẻ nhân Linux chung, chỉ khác ở phần mềm phía trên (UI, drivers, compilers, v.v.).
- **Docker và nhân**:
  - Docker sử dụng nhân của OS cơ bản (Docker host).
  - Container có thể chạy bất kỳ bản phân phối Linux nào (Debian, Fedora, CentOS) trên Docker host có nhân Linux.
  - Không thể chạy container Windows trên Docker host Linux (và ngược lại) do khác nhân.
  - Trên Windows/Mac, Docker chạy container Linux thông qua một máy ảo Linux ẩn bên dưới.

### Image và Container
- **Image**:
  - Là một gói (package) hoặc mẫu (template), tương tự như mẫu VM.
  - Được sử dụng để tạo một hoặc nhiều container.
  - Có sẵn trên Docker Hub (kho lưu trữ công cộng) cho các OS, database, công cụ (MongoDB, Redis, NodeJS, v.v.).
- **Container**:
  - Là phiên bản đang chạy của một image, chứa môi trường cô lập với các tiến trình riêng.
- **Cách sử dụng**:
  - Cài Docker trên máy chủ (host).
  - Chạy lệnh `docker run <image_name>` để khởi tạo container (ví dụ: `docker run mongodb`).
  - Có thể chạy nhiều container cùng loại (ví dụ: nhiều instance của web server) và dùng load balancer để quản lý.

### Docker và DevOps
- **Truyền thống**:
  - Nhà phát triển tạo ứng dụng, sau đó chuyển giao cho đội vận hành (ops) với hướng dẫn thiết lập phức tạp.
  - Đội vận hành gặp khó khăn khi cấu hình môi trường, đặc biệt khi xảy ra lỗi.
- **Với Docker**:
  - Nhà phát triển và đội vận hành cùng tạo **Dockerfile** chứa yêu cầu của cả hai bên.
  - Dockerfile được dùng để tạo image, đảm bảo ứng dụng chạy đồng nhất ở mọi môi trường.
  - Giảm thiểu lỗi cấu hình, thúc đẩy văn hóa DevOps (hợp tác giữa phát triển và vận hành).

## Ví dụ thực tế
- **Tình huống**:
  - Xây dựng ứng dụng với stack: NodeJS (web server), MongoDB (database), Redis (messaging system).
  - Trước đây: Cần kiểm tra tương thích OS, thư viện, phiên bản; mất nhiều thời gian thiết lập môi trường.
  - Với Docker:
    - Mỗi thành phần chạy trong container riêng (NodeJS, MongoDB, Redis).
    - Chỉ cần lệnh `docker run` để khởi chạy, không phụ thuộc vào OS cơ bản.
    - Dễ dàng mở rộng (scale) bằng cách chạy thêm container và dùng load balancer.

## Ghi chú thêm
- **Docker Hub**:
  - Kho lưu trữ công cộng chứa các image đã container hóa của nhiều ứng dụng, OS, và công cụ.
  - Có thể tự tạo image và đẩy lên Docker Hub để chia sẻ.
- **Các loại container**:
  - Docker sử dụng container LXC, nhưng cung cấp công cụ cấp cao, dễ sử dụng hơn so với LXC, LXD, LXCFS.
- **Liên kết nội bộ**:
  - Xem thêm: [[Docker Hub]], [[Container vs VM]], [[DevOps]].
