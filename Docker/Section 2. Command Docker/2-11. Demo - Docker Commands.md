# Các lệnh Docker cơ bản và cách sử dụng

## Tổng quan
- **Mục tiêu**: Giới thiệu các lệnh Docker cơ bản để quản lý và thao tác với container và hình ảnh (image), bao gồm `docker run`, `docker ps`, `docker stop`, `docker rm`, `docker images`, `docker rmi`, `docker pull`, và `docker exec`.
- **Nội dung**: Hướng dẫn cách sử dụng các lệnh này, kèm ví dụ thực tế và giải thích về cách container hoạt động.
- **Liên kết tham khảo**: [[Docker Hub]], [[Docker CLI]], [[Phòng thí nghiệm khóa học]].

## Các lệnh Docker cơ bản

### 1. Lệnh `docker run`
- **Chức năng**: Chạy một container từ một hình ảnh (image) được chỉ định.
- **Cách hoạt động**:
  - Tìm hình ảnh cục bộ (local). Nếu không có, Docker sẽ tải từ [[Docker Hub]] (chỉ lần đầu).
  - Container chạy tiến trình hoặc dịch vụ được chỉ định; nếu không, container sẽ dừng ngay.
- **Ví dụ**:
  ```bash
  docker run centos
  ```
  - Chạy container từ hình ảnh CentOS, nhưng dừng ngay vì không có tiến trình mặc định.
  ```bash
  docker run -it centos bash
  ```
  - Chạy container CentOS, khởi động shell `bash` và đăng nhập trực tiếp (tùy chọn `-it`).
  - Tùy chọn `-it`:
    - `-i`: Chế độ tương tác (interactive).
    - `-t`: Cung cấp terminal ảo (pseudo-TTY).
  - Kết quả: Đăng nhập vào container, hiển thị prompt như `root@<container_id>`.
  - Kiểm tra hệ điều hành:
    ```bash
    cat /etc/*release*
    ```
    - Xác nhận container đang chạy CentOS.
- **Chạy container ở chế độ nền (detached)**:
  ```bash
  docker run -d centos sleep 20
  ```
  - Chạy container CentOS, thực thi lệnh `sleep 20` (ngủ 20 giây) và chạy ở chế độ nền.
  - Container dừng sau khi lệnh `sleep` hoàn tất.

### 2. Lệnh `docker ps`
- **Chức năng**: Liệt kê các container đang chạy và thông tin cơ bản (ID, hình ảnh, lệnh, trạng thái, tên).
- **Ví dụ**:
  ```bash
  docker ps
  ```
  - Hiển thị container đang chạy, ví dụ: container CentOS với tên ngẫu nhiên (`flamboyant_noyce`) và lệnh `sleep 20`.
- **Tùy chọn `-a`**:
  ```bash
  docker ps -a
  ```
  - Liệt kê tất cả container (đang chạy và đã dừng).
  - Hiển thị thông tin như thời gian tạo, thời gian thoát, và mã thoát (exit code):
    - `0`: Thoát bình thường.
    - `137`: Bị dừng bởi lệnh `docker stop`.

### 3. Lệnh `docker stop`
- **Chức năng**: Dừng một container đang chạy.
- **Yêu cầu**: Cung cấp ID hoặc tên container (lấy từ `docker ps`).
- **Ví dụ**:
  ```bash
  docker stop serene_pasteur
  ```
  - Dừng container có tên `serene_pasteur`.
  - Kết quả: Container chuyển sang trạng thái `exited` (kiểm tra bằng `docker ps -a`).

### 4. Lệnh `docker rm`
- **Chức năng**: Xóa vĩnh viễn các container đã dừng.
- **Ví dụ**:
  ```bash
  docker rm 345
  docker rm e0a 773
  ```
  - Xóa container bằng ID (chỉ cần vài ký tự đầu nếu không trùng lặp) hoặc tên.
  - Có thể xóa nhiều container cùng lúc.
- **Lợi ích**: Giải phóng không gian đĩa bằng cách xóa các container không còn cần thiết.
- **Kiểm tra**:
  ```bash
  docker ps -a
  ```
  - Xác nhận các container đã bị xóa.

### 5. Lệnh `docker images`
- **Chức năng**: Liệt kê các hình ảnh có sẵn trên máy chủ và kích thước của chúng.
- **Ví dụ**:
  ```bash
  docker images
  ```
  - Hiển thị danh sách hình ảnh: `hello-world`, `ubuntu`, `centos`, `busybox` (kích thước nhỏ, ~1.13 MB, dùng để thử nghiệm nhẹ).

### 6. Lệnh `docker rmi`
- **Chức năng**: Xóa hình ảnh không còn sử dụng.
- **Yêu cầu**: Không có container nào (kể cả đã dừng) phụ thuộc vào hình ảnh đó.
- **Ví dụ**:
  ```bash
  docker rmi busybox
  docker rmi ubuntu
  ```
  - Xóa hình ảnh `busybox` và `ubuntu`.
- **Lưu ý**:
  - Nếu hình ảnh đang được container sử dụng, lệnh sẽ thất bại. Cần xóa container trước:
    ```bash
    docker rm <container_id>
    docker rmi centos
    ```

### 7. Lệnh `docker pull`
- **Chức năng**: Tải hình ảnh từ [[Docker Hub]] mà không chạy container.
- **Ví dụ**:
  ```bash
  docker pull ubuntu
  ```
  - Tải hình ảnh `ubuntu` về máy chủ, sẵn sàng cho lệnh `docker run` sau này.
  - Giảm thời gian chờ khi chạy container.

### 8. Lệnh `docker exec`
- **Chức năng**: Thực thi lệnh trong một container đang chạy.
- **Ví dụ**:
  ```bash
  docker run -d ubuntu sleep 100
  docker exec <container_id> cat /etc/*release*
  ```
  - Chạy container Ubuntu ở chế độ nền, ngủ 100 giây.
  - Thực thi lệnh `cat /etc/*release*` để xem thông tin hệ điều hành trong container.
- **Ứng dụng**: Dùng để kiểm tra hoặc thao tác với container đang chạy mà không cần đăng nhập.

## Đặc điểm của hình ảnh và container
- **Hình ảnh chính thức (Official Images)**:
  - Lưu trữ tại kho `library` trên [[Docker Hub]] (ví dụ: `centos`, `ubuntu`).
  - Có thể chạy trực tiếp bằng tên: `docker run centos`.
- **Hình ảnh tùy chỉnh**:
  - Định dạng: `<user_id>/<repository_name>` (ví dụ: `mmumshad/ansible-playable`).
  - Cần chỉ định đầy đủ khi sử dụng.
- **Hành vi container**:
  - Container chỉ hoạt động khi có tiến trình hoặc dịch vụ chạy bên trong.
  - Hình ảnh như `centos` hoặc `ubuntu` là hình ảnh cơ bản (base image), không chạy dịch vụ mặc định, nên container dừng ngay nếu không có lệnh cụ thể.
- **Tên và ID container**:
  - Docker tự động gán tên ngẫu nhiên (ví dụ: `flamboyant_noyce`, `serene_pasteur`) và ID duy nhất.
  - Có thể sử dụng vài ký tự đầu của ID nếu không trùng lặp.

## Ghi chú thêm
- **Môi trường thực hành**:
  - Các lệnh này sẽ được thực hành trong [[Phòng thí nghiệm khóa học]].
  - Khóa học sẽ cung cấp thêm chi tiết về các tham số và tùy chọn trong các bài giảng sau.
- **Liên kết nội bộ**:
  - [[Docker Hub]]: Kho lưu trữ hình ảnh Docker chính thức và tùy chỉnh.
  - [[Docker CLI]]: Tài liệu về các lệnh dòng lệnh của Docker.
  - [[Phòng thí nghiệm khóa học]]: Môi trường thực hành để làm quen với các lệnh Docker.
- **Lưu ý**:
  - Container đã dừng vẫn chiếm không gian đĩa, cần xóa bằng `docker rm`.
  - Hình ảnh không sử dụng nên xóa bằng `docker rmi` để tiết kiệm dung lượng.
