## Hiển Thị Thông Báo Sử Dụng TempData Trong ASP.NET Core

### Mục tiêu
- Thêm thông báo (notification) hiển thị trên trang danh sách danh mục (`Index`) sau khi thực hiện các thao tác CRUD (Tạo, Cập nhật, Xóa).
- Sử dụng `TempData` trong ASP.NET Core để lưu trữ và hiển thị thông báo tạm thời chỉ cho lần render tiếp theo.

### Khái niệm TempData
- **TempData**: Là một cơ chế trong ASP.NET Core dùng để lưu trữ dữ liệu tạm thời, chỉ tồn tại cho lần render tiếp theo (one-time request).
  - Sau khi trang được tải lại (refresh), dữ liệu trong `TempData` sẽ tự động bị xóa.
  - Thường được sử dụng để hiển thị thông báo thành công hoặc lỗi sau khi thực hiện một hành động (ví dụ: tạo, cập nhật, xóa).
- **Cách hoạt động**:
  - Gán giá trị vào `TempData` với một khóa (key) trong action method trước khi chuyển hướng (redirect).
  - Truy xuất giá trị từ `TempData` trên view của trang đích để hiển thị thông báo.

### Quy trình thực hiện
#### 1. Thêm Thông Báo vào TempData trong Controller
- **Vị trí**: Thêm vào các action method `POST` của các thao tác CRUD (Create, Edit, Delete) trước khi chuyển hướng về trang `Index`.
- **Thực hiện**:
  - Trong action `Create` (POST): Gán thông báo vào `TempData` với khóa `"Success"` và nội dung `"Category created successfully"`.
  - Trong action `EditPost` (POST): Gán thông báo `"Category updated successfully"`.
  - Trong action `DeletePost` (POST): Gán thông báo `"Category deleted successfully"`.

#### 2. Hiển Thị Thông Báo trên View Index
- **Vị trí**: Thêm mã hiển thị thông báo ở đầu view `Index.cshtml`.
- **Thực hiện**:
  - Kiểm tra nếu `TempData["Success"]` không phải `null`, hiển thị nội dung thông báo trong một thẻ HTML (ví dụ: `<h2>`).
  - Sử dụng cú pháp Razor (`@`) để truy xuất giá trị từ `TempData`.

### Mã nguồn
#### Controller - Thêm TempData
```csharp
[HttpPost]
public IActionResult Create(Category category)
{
    if (ModelState.IsValid)
    {
        _db.Categories.Add(category);
        _db.SaveChanges();
        TempData["Success"] = "Category created successfully";
        return RedirectToAction("Index");
    }
    return View(category);
}

[HttpPost]
[ActionName("Edit")]
public IActionResult EditPost(Category category)
{
    if (ModelState.IsValid)
    {
        _db.Categories.Update(category);
        _db.SaveChanges();
        TempData["Success"] = "Category updated successfully";
        return RedirectToAction("Index");
    }
    return View(category);
}

[HttpPost]
[ActionName("Delete")]
public IActionResult DeletePost(int id)
{
    var categoryObj = _db.Categories.Find(id);
    if (categoryObj == null)
    {
        return NotFound();
    }
    _db.Categories.Remove(categoryObj);
    _db.SaveChanges();
    TempData["Success"] = "Category deleted successfully";
    return RedirectToAction("Index");
}
```

#### View Index.cshtml - Hiển Thị Thông Báo
```html
@model IEnumerable<Category>

@if (TempData["Success"] != null)
{
    <h2>@TempData["Success"]</h2>
}

<table class="table">
    <thead>
        <tr>
            <th>Tên Danh Mục</th>
            <th>Thứ Tự Hiển Thị</th>
            <th>Hành Động</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr>
                <td>@item.Name</td>
                <td>@item.DisplayOrder</td>
                <td>
                    <a asp-action="Edit" asp-route-id="@item.Id" class="btn btn-primary">Sửa</a>
                    <a asp-action="Delete" asp-route-id="@item.Id" class="btn btn-danger">Xóa</a>
                </td>
            </tr>
        }
    </tbody>
</table>
```

### Kiểm tra chức năng
- **Tạo danh mục**:
  - Tạo một danh mục mới (ví dụ: "Test Category", thứ tự hiển thị 4).
  - Sau khi tạo thành công, trang `Index` hiển thị thông báo: "Category created successfully".
  - Tải lại trang (refresh), thông báo biến mất do `TempData` chỉ tồn tại trong một lần render.
- **Cập nhật danh mục**:
  - Sửa một danh mục (ví dụ: thay đổi thứ tự hiển thị thành 44).
  - Trang `Index` hiển thị thông báo: "Category updated successfully".
  - Tải lại trang, thông báo biến mất.
- **Xóa danh mục**:
  - Xóa một danh mục.
  - Trang `Index` hiển thị thông báo: "Category deleted successfully".
  - Tải lại trang, thông báo biến mất.

### Ghi chú thêm
- **Ưu điểm của TempData**:
  - Đơn giản và hiệu quả cho việc hiển thị thông báo tạm thời.
  - Tự động xóa sau một lần render, tránh lưu trữ dữ liệu không cần thiết.
- **Lưu ý**:
  - Đảm bảo khóa `TempData` (ví dụ: `"Success"`) được sử dụng nhất quán trong controller và view.
  - Có thể tùy chỉnh giao diện thông báo (ví dụ: sử dụng thẻ `<div>` với lớp CSS như `alert-success` thay vì `<h2>` để cải thiện trải nghiệm người dùng).

### Liên kết liên quan
- [[Quản lý danh mục]]
- [[TempData trong ASP.NET Core]]
- [[Action Method trong ASP.NET]]
- [[Cơ sở dữ liệu (Database)]]