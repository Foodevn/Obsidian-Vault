## Bố cục và Tệp View trong ASP.NET Core MVC

### Mục tiêu
- Hiểu vai trò của **bố cục (layout)** trong việc định dạng giao diện chung cho ứng dụng MVC.
- Nắm rõ chức năng của các tệp trong thư mục `Views` như `_Layout.cshtml`, `_ViewStart.cshtml`, `_ViewImports.cshtml` và **partial view**.
- Hiểu cách ứng dụng xác định bố cục mặc định và sử dụng **tag helper** hoặc **using statement** trong view.

---

### 1. Cấu trúc thư mục Views
- Thư mục `Views` chứa các tệp giao diện (`.cshtml`) được tổ chức theo kiến trúc MVC:
  - **Thư mục con theo tên controller**: Ví dụ, thư mục `Home` chứa `Index.cshtml`, `Privacy.cshtml` cho `HomeController`.
  - **Thư mục Shared**: Chứa các tệp dùng chung, như `_Layout.cshtml`, `_ValidationScriptsPartial.cshtml`, `Error.cshtml`.
  - **Tệp đặc biệt**:
    - `_ViewStart.cshtml`: Chỉ định bố cục mặc định.
    - `_ViewImports.cshtml`: Quản lý các `using statement` và **tag helper** toàn cục.
    - `Error.cshtml`: Hiển thị thông báo lỗi khi ứng dụng gặp sự cố.

---

### 2. Bố cục (_Layout.cshtml)
- **_Layout.cshtml**:
  - Là **trang chính (master page)**, định nghĩa cấu trúc chung cho mọi view (header, footer, CSS, JavaScript).
  - Nằm trong thư mục `Views/Shared`.
- **Cấu trúc chính**:
  ```cshtml
  <!DOCTYPE html>
  <html>
  <head>
      <title>My Application</title>
      <link rel="stylesheet" href="~/css/site.css" />
  </head>
  <body>
      <header>
          <nav>
              <a asp-controller="Home" asp-action="Index">Home</a>
              <a asp-controller="Home" asp-action="Privacy">Privacy</a>
          </nav>
      </header>
      @RenderBody() <!-- Nội dung view từ controller -->
      <footer>
          <p>&copy; BulkyWeb</p>
      </footer>
  </body>
  </html>
  ```
- **@RenderBody()**:
  - Helper tích hợp của MVC, hiển thị nội dung của view được trả về từ controller.
  - Ví dụ: Nếu controller trả về `Index.cshtml`, nội dung của tệp này sẽ xuất hiện tại `@RenderBody()`.

- **Lưu ý**:
  - `_Layout.cshtml` chứa các tài nguyên toàn cục (CSS, JavaScript) và các thành phần giao diện dùng chung (header, footer).
  - Tiền tố `_` biểu thị đây là tệp dùng chung, không hiển thị độc lập.

---

### 3. Xác định bố cục mặc định (_ViewStart.cshtml)
- **_ViewStart.cshtml**:
  - Xác định bố cục mặc định cho toàn ứng dụng, thường nằm trong thư mục `Views`.
  - Ví dụ:
    ```cshtml
    @{
        Layout = "_Layout";
    }
    ```
  - Ý nghĩa: Mọi view sẽ sử dụng `_Layout.cshtml` làm bố cục, trừ khi được chỉ định khác.
- **Lỗi cấu hình**:
  - Nếu đổi tên `_Layout.cshtml` thành `Layout.cshtml` mà không cập nhật `_ViewStart.cshtml`, ứng dụng sẽ báo lỗi vì không tìm thấy bố cục.
  - Cách sửa: Đảm bảo tên trong `_ViewStart.cshtml` khớp với tên tệp bố cục.
- **Lưu ý**:
  - Tên `_Layout` là chuẩn khuyến nghị trong ASP.NET Core.
  - Xem thêm: [[Cấu hình ViewStart trong MVC]].

---

### 4. Partial View (_ValidationScriptsPartial.cshtml)
- **Partial View**:
  - Là các view không hiển thị độc lập, được nhúng vào view chính hoặc bố cục.
  - Thường có tiền tố `_` (ví dụ: `_ValidationScriptsPartial.cshtml`).
  - Dùng để tái sử dụng mã giao diện, như JavaScript hoặc các thành phần giao diện.
- **Ví dụ: _ValidationScriptsPartial.cshtml**:
  - Chứa các tệp JavaScript cho **xác thực phía client (client-side validation)**:
    ```cshtml
    <script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
    <script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>
    ```
  - Chỉ được nhúng vào các view cần xác thực, tránh tải JavaScript không cần thiết.
- **Lưu ý**:
  - Tiền tố `_` giúp nhận biết partial view, không bắt buộc nhưng là quy ước.
  - Xem thêm: [[Partial View trong MVC]].

---

### 5. View Imports (_ViewImports.cshtml)
- **_ViewImports.cshtml**:
  - Quản lý các **using statement** và **tag helper** dùng chung cho tất cả view.
  - Ví dụ:
    ```cshtml
    @using BulkyWeb
    @using BulkyWeb.Models
    @addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
    ```
  - **Chức năng**:
    - **Using statement**: Tránh lặp lại `using` trong từng view.
    - **Tag helper**: Kích hoạt các tag như `asp-controller`, `asp-action` để tạo liên kết động.
- **Phạm vi**:
  - Chỉ áp dụng cho view, không áp dụng cho controller hoặc model.
  - Xem thêm: [[Tag Helper trong ASP.NET Core]].

---

### 6. Tag Helper
- **Tag Helper**:
  - Các thuộc tính HTML đặc biệt (ví dụ: `asp-controller`, `asp-action`) dùng để tạo liên kết động.
  - Ví dụ trong `_Layout.cshtml`:
    ```cshtml
    <a asp-controller="Home" asp-action="Index">Home</a>
    <a asp-controller="Home" asp-action="Privacy">Privacy</a>
    ```
  - Ý nghĩa: Tạo URL động đến `HomeController` với các action `Index` hoặc `Privacy`.
- **Lợi ích**:
  - Giảm lỗi khi tạo liên kết, tăng tính linh hoạt.
  - Sẽ được giải thích chi tiết trong [[Tag Helper trong ASP.NET Core]].

---

### 7. View lỗi (Error.cshtml)
- **Error.cshtml**:
  - View mặc định để hiển thị thông báo lỗi khi ứng dụng gặp sự cố.
  - Nằm trong `Views/Shared`, có thể bỏ qua ở giai đoạn này.

---

### 8. Ví dụ minh họa
- **_Layout.cshtml**:
  ```cshtml
  <!DOCTYPE html>
  <html>
  <head>
      <title>My Application</title>
      <link rel="stylesheet" href="~/css/site.css" />
  </head>
  <body>
      <header>
          <nav>
              <a asp-controller="Home" asp-action="Index">Home</a>
              <a asp-controller="Home" asp-action="Privacy">Privacy</a>
          </nav>
      </header>
      @RenderBody()
      <footer>
          <p>&copy; BulkyWeb</p>
      </footer>
  </body>
  </html>
  ```

- **_ViewStart.cshtml**:
  ```cshtml
  @{
      Layout = "_Layout";
  }
  ```

- **_ViewImports.cshtml**:
  ```cshtml
  @using BulkyWeb
  @using BulkyWeb.Models
  @addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
  ```

---

### 9. Ghi chú thêm
- **Tiền tố `_`**:
  - Được sử dụng để đánh dấu các tệp dùng chung (layout, partial view).
  - Giúp dễ nhận biết khi quản lý dự án.
- **Lợi ích của bố cục**:
  - Đảm bảo giao diện đồng nhất, giảm mã lặp lại.
  - Tăng khả năng bảo trì và mở rộng.
- **Liên kết nội bộ**:
  - Xem [[Client-Side Validation trong MVC]] để hiểu về xác thực.
  - Xem [[Cấu trúc thư mục MVC]] để hiểu tổ chức dự án.

---

### 10. Kết luận
- **_Layout.cshtml** định nghĩa giao diện chung với header, footer và `@RenderBody()` cho nội dung động.
- **_ViewStart.cshtml** chỉ định bố cục mặc định.
- **_ViewImports.cshtml** quản lý import toàn cục.
- **Partial view** như `_ValidationScriptsPartial.cshtml` tối ưu hóa tái sử dụng mã.
- Hiểu các khái niệm này giúp xây dựng ứng dụng MVC hiệu quả. Thực hành tiếp theo sẽ làm rõ hơn về [[Kiến trúc MVC]].