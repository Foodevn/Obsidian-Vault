## Tích hợp Thông báo Toastr và Partial View trong Razor Pages

### Mục tiêu
- Thêm thông báo Toastr để hiển thị thông tin khi tạo, chỉnh sửa hoặc xóa danh mục trong dự án Razor Pages.
- Tích hợp partial view để hiển thị thông báo trong giao diện.
- Chuẩn bị nền tảng cho việc sử dụng Razor Pages với .NET Identity trong các phần sau của khóa học.

### Tích hợp Partial View cho Toastr
1. **Tạo Partial View `_Notification.cshtml`**:
   - Trong thư mục `Pages/Shared`, nhấp chuột phải, chọn **Add > Razor Page**, chọn **Razor Page - Empty**, và đặt tên là `_Notification.cshtml`.
   - **Lưu ý**: Xóa tệp `_Notification.cshtml.cs` vì partial view không cần Page Model.
   - Sao chép nội dung từ partial view `_Notification.cshtml` của dự án MVC (thư mục `Views/Shared`) sang `Pages/Shared/_Notification.cshtml`.
   - Ví dụ nội dung `_Notification.cshtml`:
     ```cshtml
     @if (TempData["success"] != null)
     {
         <script src="~/lib/toastr/toastr.min.js"></script>
         <script>
             toastr.success('@TempData["success"]');
         </script>
     }
     @if (TempData["error"] != null)
     {
         <script src="~/lib/toastr/toastr.min.js"></script>
         <script>
             toastr.error('@TempData["error"]');
         </script>
     }
     ```
   - **Giải thích**: Partial view kiểm tra `TempData` để hiển thị thông báo thành công hoặc lỗi bằng thư viện Toastr.

2. **Thêm Partial View vào `_Layout.cshtml`**:
   - Mở `Pages/Shared/_Layout.cshtml` trong dự án Razor Pages.
   - Thêm dòng gọi partial view trước thẻ `<div class="container">` hoặc vị trí phù hợp:
     ```cshtml
     <partial name="_Notification" />
     ```
   - Thêm liên kết đến thư viện Toastr trong phần `<head>` của `_Layout.cshtml`:
     ```cshtml
     <link rel="stylesheet" href="~/lib/toastr/toastr.min.css" />
     ```

3. **Kiểm tra thư viện Toastr**:
   - Đảm bảo thư viện Toastr (`toastr.min.js` và `toastr.min.css`) đã được thêm vào thư mục `wwwroot/lib/toastr`. Nếu chưa, sao chép từ dự án MVC hoặc tải từ CDN.

### Cấu hình TempData trong Page Models
1. **Cập nhật `Create.cshtml.cs`**:
   - Trong `Pages/Categories/Create.cshtml.cs`, thêm `TempData` trước khi chuyển hướng:
     ```csharp
     public IActionResult OnPost()
     {
         if (ModelState.IsValid)
         {
             _db.Categories.Add(Category);
             _db.SaveChanges();
             TempData["success"] = "Danh mục đã được tạo thành công!";
             return RedirectToPage("/Categories/Index");
         }
         return Page();
     }
     ```

2. **Cập nhật `Edit.cshtml.cs`**:
   - Trong `Pages/Categories/Edit.cshtml.cs`, thêm `TempData`:
     ```csharp
     public IActionResult OnPost()
     {
         if (ModelState.IsValid)
         {
             _db.Categories.Update(Category);
             _db.SaveChanges();
             TempData["success"] = "Danh mục đã được cập nhật thành công!";
             return RedirectToPage("/Categories/Index");
         }
         return Page();
     }
     ```

3. **Cập nhật `Delete.cshtml.cs`**:
   - Trong `Pages/Categories/Delete.cshtml.cs`, thêm `TempData`:
     ```csharp
     public IActionResult OnPost()
     {
         if (Category == null)
         {
             return NotFound();
         }
         _db.Categories.Remove(Category);
         _db.SaveChanges();
         TempData["success"] = "Danh mục đã được xóa thành công!";
         return RedirectToPage("/Categories/Index");
     }
     ```

### Kiểm tra kết quả
1. **Chạy ứng dụng**:
   - Đặt `BulkyWeb_Razor_Temp` làm **Startup Project** và chạy.
   - Truy cập `/Categories`, thực hiện các thao tác:
     - **Tạo mới**: Nhập dữ liệu và nhấn **Tạo**. Thông báo "Danh mục đã được tạo thành công!" sẽ hiển thị.
     - **Chỉnh sửa**: Nhấp **Sửa**, thay đổi dữ liệu, nhấn **Lưu**. Thông báo "Danh mục đã được cập nhật thành công!" sẽ hiển thị.
     - **Xóa**: Nhấp **Xóa**, xác nhận xóa. Thông báo "Danh mục đã được xóa thành công!" sẽ hiển thị.

2. **Xử lý lỗi**:
   - Nếu thông báo Toastr không hiển thị, kiểm tra:
     - Đường dẫn đến `toastr.min.js` và `toastr.min.css` trong `wwwroot/lib/toastr`.
     - Partial view `_Notification.cshtml` được thêm đúng vào `_Layout.cshtml`.
     - `TempData["success"]` được đặt trong Page Model.

### Ghi chú thêm
- **Tương tự MVC**: Quy trình tích hợp Toastr và partial view trong Razor Pages tương tự như trong MVC, sử dụng `TempData` và partial view để hiển thị thông báo.
- **Chuẩn bị cho .NET Identity**: Razor Pages là nền tảng cho .NET Identity, nên việc làm quen với Page Model, `OnGet`, `OnPost` và các tag helper (`asp-page`) sẽ hữu ích khi làm việc với các trang Identity (như đăng nhập, đăng ký).
- **Quản lý tệp**: Đóng hoặc thu nhỏ dự án MVC để tránh nhầm lẫn khi làm việc với các tệp có tên tương tự.

### Liên kết nội bộ
- [[Razor Pages]]
- [[Model–View–Controller]]
- [[Entity Framework Core]]
- [[Thực hiện CRUD trong Razor Pages]]
- [[.NET Identity trong Razor Pages]]