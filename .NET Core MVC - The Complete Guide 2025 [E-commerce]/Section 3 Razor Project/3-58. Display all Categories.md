## Hiển thị Danh sách Danh mục trong Razor Pages

### Mục tiêu
- Tải danh sách danh mục (Categories) từ cơ sở dữ liệu và hiển thị trên trang Razor.
- Sử dụng Entity Framework Core (EF Core) và Page Model để xử lý dữ liệu.
- Cập nhật giao diện và định tuyến trong Razor Pages để hiển thị danh sách danh mục tương tự như trong dự án MVC.

### Tích hợp Entity Framework Core trong Page Model
1. **Thêm `ApplicationDbContext` vào Page Model**:
   - Trong tệp `Pages/Categories/Index.cshtml.cs`, thêm constructor để tiêm phụ thuộc (dependency injection) `ApplicationDbContext`:
     ```csharp
     using BulkyWeb_Razor_Temp.Data;
     using BulkyWeb_Razor_Temp.Models;
     using Microsoft.EntityFrameworkCore;
     using System.Collections.Generic;

     namespace BulkyWeb_Razor_Temp.Pages.Categories
     {
         public class IndexModel : PageModel
         {
             private readonly ApplicationDbContext _db;
             public List<Category> CategoryList { get; set; }

             public IndexModel(ApplicationDbContext db)
             {
                 _db = db;
             }

             public void OnGet()
             {
                 CategoryList = _db.Categories.ToList();
             }
         }
     }
     ```
   - **Giải thích**:
     - `private readonly ApplicationDbContext _db`: Khai báo biến để lưu trữ DbContext.
     - Constructor nhận `ApplicationDbContext` qua dependency injection và gán vào `_db`.
     - `List<Category> CategoryList`: Thuộc tính để lưu danh sách danh mục.
     - `OnGet()`: Phương thức xử lý yêu cầu GET, tải danh sách danh mục từ cơ sở dữ liệu bằng `_db.Categories.ToList()`.

2. **So sánh với MVC**:
   - Trong MVC, việc tải danh sách danh mục được thực hiện trong *Controller* (ví dụ: `CategoriesController`) và trả về *View* qua `return View(model)`.
   - Trong Razor Pages, không cần `return View` vì Page Model tự động liên kết dữ liệu với trang `.cshtml` thông qua `@model`. Phương thức `OnGet` có kiểu trả về `void`.

### Cập nhật giao diện trong `Index.cshtml`
1. **Sao chép giao diện từ MVC**:
   - Sao chép mã giao diện từ tệp `Views/Categories/Index.cshtml` của dự án MVC sang `Pages/Categories/Index.cshtml` trong dự án Razor Pages.
   - **Lưu ý**: Đóng tệp gốc để tránh nhầm lẫn vì tên tệp giống nhau.

2. **Chỉnh sửa giao diện**:
   - Xóa chỉ thị `@model` cũ (dành cho MVC) vì Razor Pages sử dụng `@model BulkyWeb_Razor_Temp.Pages.Categories.IndexModel`.
   - Cập nhật các thẻ tag helper để phù hợp với Razor Pages:
     - Thay `asp-controller` và `asp-action` bằng `asp-page`.
     - Ví dụ:
       - Liên kết đến trang tạo danh mục: `<a asp-page="/Categories/Create">Create New</a>`.
       - Liên kết chỉnh sửa: `<a asp-page="/Categories/Edit" asp-route-id="@obj.Id">Edit</a>`.
       - Liên kết xóa: `<a asp-page="/Categories/Delete" asp-route-id="@obj.Id">Delete</a>`.
   - Thay `@Model` (trong MVC) bằng `@Model.CategoryList` vì `CategoryList` là thuộc tính trong `IndexModel`.
   - Ví dụ mã `Index.cshtml`:
     ```cshtml
     @page
     @model BulkyWeb_Razor_Temp.Pages.Categories.IndexModel
     <h1>Danh sách Danh mục</h1>

     <div>
         <a asp-page="/Categories/Create" class="btn btn-primary">Tạo mới</a>
     </div>
     <table class="table">
         <thead>
             <tr>
                 <th>Tên</th>
                 <th>Thứ tự hiển thị</th>
                 <th>Thao tác</th>
             </tr>
         </thead>
         <tbody>
             @foreach (var obj in Model.CategoryList)
             {
                 <tr>
                     <td>@obj.Name</td>
                     <td>@obj.DisplayOrder</td>
                     <td>
                         <a asp-page="/Categories/Edit" asp-route-id="@obj.Id" class="btn btn-primary">Sửa</a>
                         <a asp-page="/Categories/Delete" asp-route-id="@obj.Id" class="btn btn-danger">Xóa</a>
                     </td>
                 </tr>
             }
         </tbody>
     </table>
     ```

3. **Cập nhật Layout**:
   - Trong tệp `Pages/Shared/_Layout.cshtml`, thêm liên kết đến trang danh mục trong menu điều hướng:
     ```cshtml
     <li class="nav-item">
         <a class="nav-link text-dark" asp-page="/Categories/Index">Danh mục</a>
     </li>
     ```
   - Điều này cho phép người dùng truy cập trang danh sách danh mục từ menu.

### Định tuyến trong Razor Pages
- Trang `Pages/Categories/Index.cshtml` được truy cập qua URL `/Categories` hoặc `/Categories/Index`.
- Thẻ `asp-page` chỉ định đường dẫn đến trang Razor (ví dụ: `/Categories/Create`, `/Categories/Edit`).
- Thẻ `asp-route-id` được sử dụng để truyền tham số (như `Id`) trong URL, tương tự như trong MVC.

### Kiểm tra kết quả
1. **Chạy dự án**:
   - Đặt `BulkyWeb_Razor_Temp` làm **Startup Project** và chạy ứng dụng.
   - Truy cập URL `/Categories` để xem danh sách danh mục.
   - Kết quả: Hiển thị bảng danh sách danh mục với các nút **Tạo mới**, **Sửa**, **Xóa**.

2. **Lưu ý về phương thức `OnGet`**:
   - Tên phương thức phải là `OnGet` (hoặc `OnPost` cho POST). Nếu đổi thành `Get`, trang sẽ không hoạt động.
   - Ví dụ: Nếu sửa `OnGet` thành `Get` trong `Index.cshtml.cs`, truy cập `/Categories` sẽ gây lỗi vì Razor Pages yêu cầu tên phương thức chính xác.

### Ghi chú thêm
- **Giao diện**: Trang hiện sử dụng các lớp CSS mặc định. Có thể thêm Bootstrap Icons hoặc chủ đề Bootswatch để cải thiện giao diện.
- **Khác biệt với MVC**: Razor Pages tích hợp logic và giao diện trong cùng một trang, loại bỏ sự phức tạp của *Controller* và *Action*.
- Tiếp theo, cần tạo các trang `Create`, `Edit`, `Delete` để hoàn thiện chức năng CRUD: [[Thực hiện CRUD trong Razor Pages]].

### Liên kết nội bộ
- [[Razor Pages]]
- [[Model–View–Controller]]
- [[Entity Framework Core]]
- [[Thực hiện CRUD trong Razor Pages]]
- [[Cấu hình Entity Framework Core trong ASP.NET Core]]