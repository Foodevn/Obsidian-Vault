## Razor Pages trong ASP.NET Core: So sánh và Cấu hình Cơ bản

### Mục tiêu
- Hiểu các điểm tương đồng và khác biệt giữa dự án Razor Pages và MVC trong ASP.NET Core.
- Cấu hình Entity Framework Core trong dự án Razor Pages, tương tự như trong dự án MVC.
- Chuẩn bị môi trường để thực hiện các thao tác CRUD với Razor Pages.

### So sánh Razor Pages và MVC
#### Điểm tương đồng
- **Tệp cấu hình**:
  - Cả hai dự án đều sử dụng `appsettings.json` để lưu trữ các thiết lập, ví dụ: chuỗi kết nối cơ sở dữ liệu (connection string).
  - Tệp `Program.cs` có chức năng tương tự, nhưng có một số khác biệt trong cấu hình dịch vụ.
- **Thư mục `wwwroot`**:
  - Giống nhau ở cả hai dự án, chứa các tài nguyên tĩnh như CSS, JavaScript, hình ảnh.
- **Thư mục `Shared`**:
  - Chứa các tệp như `_Layout.cshtml`, `_ValidationScriptsPartial.cshtml`, `_ViewImports.cshtml`, `_ViewStart.cshtml`, và trang lỗi (`Error.cshtml`), giống hệt trong MVC.
- **Dependencies và Properties**:
  - Cả hai dự án có cấu trúc dependencies và properties tương tự.

#### Điểm khác biệt
- **Cấu trúc dự án**:
  - **MVC**: Sử dụng cấu trúc *Model–View–Controller* với các thư mục `Controllers`, `Models`, `Views`.
  - **Razor Pages**: Không có `Controllers` hay `Views`, thay vào đó sử dụng thư mục `Pages` chứa các tệp `.cshtml` (kết hợp logic và giao diện).
- **Cấu hình dịch vụ trong `Program.cs`**:
  - **MVC**: Thêm dịch vụ `ControllersWithViews` vào container (`builder.Services.AddControllersWithViews()`).
  - **Razor Pages**: Thêm dịch vụ `RazorPages` (`builder.Services.AddRazorPages()`).
- **Định tuyến (Routing)**:
  - **MVC**: Định tuyến dựa trên *Controller* và *Action* (ví dụ: `/Home/Privacy`).
  - **Razor Pages**: Định tuyến dựa trên cấu trúc thư mục trong `Pages`. Tên tệp và thư mục xác định URL (ví dụ: `/Index`, `/Privacy`).
  - Sử dụng `MapRazorPages()` trong `Program.cs` để kích hoạt định tuyến Razor Pages.
- **Cú pháp Razor Pages**:
  - Mỗi trang Razor có chỉ thị `@page` để xác định đây là một trang Razor.
  - Tệp `.cshtml` đi kèm tệp `.cs` (Page Model), kế thừa từ lớp `PageModel` trong ASP.NET Core.
  - Page Model chứa các phương thức xử lý như `OnGet`, `OnPost`, tương tự các *Action* trong *Controller* của MVC.

### Cấu trúc thư mục Pages
- Thư mục `Pages` chứa các tệp `.cshtml`, ví dụ: `Index.cshtml`, `Privacy.cshtml`.
- Mỗi tệp `.cshtml` có thể chứa:
  - Cú pháp Razor (sử dụng `@` để viết mã C#).
  - Chỉ thị `@page` để đánh dấu là trang Razor.
  - Tệp `.cs` (Page Model) chứa logic xử lý (ví dụ: `OnGet`, `OnPost`).

### Cấu hình Entity Framework Core trong Razor Pages
#### Bước 1: Thêm mô hình (Model)
- Tạo thư mục `Models` trong dự án Razor Pages.
- Sao chép lớp `Category` từ dự án MVC sang thư mục `Models`:
  - Lưu ý: Không sao chép trực tiếp để tránh lỗi namespace. Tạo lớp mới và dán nội dung mã.
  - Ví dụ nội dung lớp `Category`:
    ```csharp
    namespace BulkyWeb_Razor_Temp.Models
    {
        public class Category
        {
            public int Id { get; set; }
            public string Name { get; set; }
            public int DisplayOrder { get; set; }
        }
    }
    ```

#### Bước 2: Cấu hình chuỗi kết nối
- Trong `appsettings.json`, thêm chuỗi kết nối (connection string) tương tự như dự án MVC, nhưng thay đổi tên cơ sở dữ liệu:
  ```json
  "ConnectionStrings": {
    "DefaultConnection": "Server=localhost;Database=Bulky_Razor;Trusted_Connection=True;"
  }
  ```

#### Bước 3: Cài đặt các gói NuGet
- Cài đặt các gói NuGet giống như trong dự án MVC:
  - `Microsoft.EntityFrameworkCore`
  - `Microsoft.EntityFrameworkCore.SqlServer`
  - `Microsoft.EntityFrameworkCore.Tools`
- Cách cài đặt:
  - Nhấp chuột phải vào dự án, chọn **Manage NuGet Packages**.
  - Tìm và cài đặt các gói trên.

#### Bước 4: Tạo lớp ApplicationDbContext
- Tạo thư mục `Data` trong dự án.
- Thêm lớp `ApplicationDbContext` trong thư mục `Data`:
  ```csharp
  using BulkyWeb_Razor_Temp.Models;
  using Microsoft.EntityFrameworkCore;

  namespace BulkyWeb_Razor_Temp.Data
  {
      public class ApplicationDbContext : DbContext
      {
          public ApplicationDbContext(DbContextOptions<ApplicationDbContext> options)
              : base(options)
          {
          }

          public DbSet<Category> Categories { get; set; }
      }
  }
  ```

#### Bước 5: Cấu hình dịch vụ trong `Program.cs`
- Thêm dịch vụ Entity Framework Core vào `Program.cs`:
  ```csharp
  builder.Services.AddDbContext<ApplicationDbContext>(options =>
      options.UseSqlServer(builder.Configuration.GetConnectionString("DefaultConnection")));
  ```

#### Bước 6: Tạo dữ liệu mẫu (Seeding)
- Tạo dữ liệu mẫu cho bảng `Categories` trong `ApplicationDbContext`:
  ```csharp
  protected override void OnModelCreating(ModelBuilder modelBuilder)
  {
      modelBuilder.Entity<Category>().HasData(
          new Category { Id = 1, Name = "Category 1", DisplayOrder = 1 },
          new Category { Id = 2, Name = "Category 2", DisplayOrder = 2 },
          new Category { Id = 3, Name = "Category 3", DisplayOrder = 3 }
      );
  }
  ```

#### Lưu ý quan trọng
- **Không chạy migration hoặc cập nhật cơ sở dữ liệu ngay**. Hãy chờ hướng dẫn trong video tiếp theo để tránh lỗi cấu hình.
- Đảm bảo hoàn thành các bước cấu hình trên để chuẩn bị cho việc thêm migration.

### Bài tập
- Cấu hình Entity Framework Core trong dự án Razor Pages:
  - Thêm mô hình `Category`.
  - Cài đặt các gói NuGet cần thiết.
  - Tạo lớp `ApplicationDbContext` và cấu hình chuỗi kết nối.
  - Thêm dữ liệu mẫu cho bảng `Categories`.
- Không thực hiện migration hoặc cập nhật cơ sở dữ liệu cho đến khi có hướng dẫn tiếp theo.

### Liên kết nội bộ
- [[Razor Pages]]
- [[Model–View–Controller]]
- [[Entity Framework Core]]
- [[Cấu hình Entity Framework Core trong ASP.NET Core]]
- [[Tái hiện dự án MVC bằng Razor Pages]]