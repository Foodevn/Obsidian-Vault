## Tách biệt logic dự án Bulky sang các dự án con

### Mục đích
- Tách biệt các thành phần logic trong dự án **BulkyWeb** sang các dự án con (**Bulky.DataAccess**, **Bulky.Models**, **Bulky.Utility**) để tăng tính mô-đun hóa, dễ bảo trì và quản lý.
- Cập nhật không gian tên (namespace) và tham chiếu dự án để đảm bảo ứng dụng hoạt động đúng sau khi di chuyển.

### Các bước thực hiện

#### 1. Di chuyển thư mục và tệp
- **Thư mục `Data`**:
  - Di chuyển thư mục `Data` từ **BulkyWeb** sang **Bulky.DataAccess**.
  - Nội dung:
    - Lớp ngữ cảnh cơ sở dữ liệu (**ApplicationDbContext**).
    - Thư mục `Migrations` (chứa các tệp di cư cơ sở dữ liệu).
  - Xóa thưrance mục `Data` khỏi **BulkyWeb** sau khi di chuyển.
- **Thư mục `Models`**:
  - Di chuyển thư mục `Models` từ **BulkyWeb** sang **Bulky.Models**.
  - Nội dung: Các lớp mô hình (ví dụ: `Category`).
  - Xóa thư mục `Models` khỏi **BulkyWeb** sau khi di chuyển.
- **Thư mục `Utility`**:
  - Tạo một lớp mới trong **Bulky.Utility** có tên `SD` (Static Details).
  - **Cấu trúc**:
    ```csharp
    public static class SD
    {
        // Các hằng số của ứng dụng sẽ được định nghĩa ở đây
    }
    ```
  - Lớp này sẽ chứa các hằng số (constants) của ứng dụng.

#### 2. Cập nhật gói NuGet cho **Bulky.DataAccess**
- **Vấn đề**: Sau khi di chuyển `ApplicationDbContext` và `Migrations`, xuất hiện lỗi do thiếu các gói NuGet liên quan đến Entity Framework Core.
- **Giải pháp**:
  - Mở **Manage NuGet Packages for Solution** từ Solution Explorer.
  - Cài đặt các gói sau cho **Bulky.DataAccess**:
    - `Microsoft.EntityFrameworkCore`
    - `Microsoft.EntityFrameworkCore.SqlServer`
    - `Microsoft.EntityFrameworkCore.Tools`
  - **Kết quả**: Các lỗi liên quan đến Entity Framework Core được giải quyết.

#### 3. Cập nhật không gian tên (namespace)
- **Trong `Bulky.DataAccess`**:
  - Cập nhật không gian tên trong `ApplicationDbContext.cs` từ `BulkyWeb.Data` thành `Bulky.DataAccess.Data`.
  - Cập nhật không gian tên trong các tệp di cư (`.cs` và `.Designer.cs`) từ `BulkyWeb.Data.Migrations` thành `Bulky.DataAccess.Data.Migrations`.
  - **Lưu ý**: Cần sửa cả tệp `.Designer.cs` để đồng bộ với tệp `.cs`, nếu không sẽ gặp lỗi biên dịch.
- **Trong `Bulky.Models`**:
  - Di chuyển các lớp mô hình (ví dụ: `Category.cs`) trực tiếp vào thư mục gốc của **Bulky.Models**.
  - Cập nhật không gian tên từ `BulkyWeb.Models` thành `Bulky.Models`.
- **Kết quả**: Các lỗi liên quan đến không gian tên được giải quyết.

#### 4. Thêm tham chiếu dự án
- **Vấn đề**: **Bulky.DataAccess** và **BulkyWeb** cần truy cập vào các lớp trong **Bulky.Models** và **Bulky.Utility**, nhưng xuất hiện lỗi do thiếu tham chiếu.
- **Giải pháp**:
  - Trong **Bulky.DataAccess**:
    - Thêm tham chiếu dự án (project reference) tới **Bulky.Models** và **Bulky.Utility**.
  - Trong **BulkyWeb**:
    - Thêm tham chiếu dự án tới **Bulky.DataAccess**, **Bulky.Models** và **Bulky.Utility**.
  - Thêm câu lệnh `using` phù hợp (ví dụ: `using Bulky.Models;`) hoặc sử dụng phím tắt `Ctrl + .` để tự động thêm.
- **Kết quả**: Các lỗi biên dịch liên quan đến tham chiếu được giải quyết.

#### 5. Cập nhật không gian tên trong Views
- **Vấn đề**: Các tệp View (như `Views/Category/Index.cshtml`) sử dụng mô hình (ví dụ: `ErrorViewModel`) nhưng không tìm thấy do không gian tên đã thay đổi.
- **Giải pháp**:
  - Thêm không gian tên `Bulky.Models` vào tệp `_ViewImports.cshtml`:
    ```csharp
    @using Bulky.Models
    ```
  - Điều này giúp tất cả các View tự động nhận diện các lớp trong `Bulky.Models` mà không cần thêm `using` trong từng tệp.
- **Kết quả**: Các lỗi trong View được giải quyết.

#### 6. Xử lý lỗi còn lại
- **Vấn đề**: Lỗi trong tệp `SeedCategoryTable` hoặc các tệp di cư do thiếu câu lệnh `using` hoặc không gian tên không chính xác.
- **Giải pháp**:
  - Thêm các câu lệnh `using` cần thiết (ví dụ: `using Bulky.Models;`) trong các tệp bị lỗi.
  - Kiểm tra và sửa không gian tên trong cả tệp `.cs` và `.Designer.cs` của di cư.
- **Kết quả**: Dự án **Bulky.DataAccess** biên dịch thành công.

#### 7. Kiểm tra ứng dụng
- Chạy dự án **BulkyWeb** để kiểm tra:
  - Các trang (Create, Edit, Delete, Index) tải đúng và hoạt động như mong đợi.
  - Giao diện và logic vẫn hoạt động bình thường sau khi tách biệt.
- **Kết quả**: Ứng dụng hoạt động tốt, với cấu trúc dự án sạch hơn và mô-đun hóa cao hơn.

### Kết quả tổng thể
- **Cấu trúc dự án**:
  - **BulkyWeb**: Chỉ chứa logic giao diện (Views, Controllers) và cấu hình chính.
  - **Bulky.DataAccess**: Quản lý truy cập cơ sở dữ liệu (`ApplicationDbContext`, `Migrations`).
  - **Bulky.Models**: Chứa các mô hình dữ liệu (`Category`, `ErrorViewModel`, v.v.).
  - **Bulky.Utility**: Chứa các hằng số và tiện ích (`SD`).
- Ứng dụng được tổ chức theo nguyên tắc trách nhiệm đơn nhất (Single Responsibility Principle), dễ bảo trì và mở rộng.

### Ghi chú thêm
- Việc tách biệt dự án thường được thực hiện khi dự án phát triển phức tạp, giúp quản lý mã nguồn hiệu quả hơn.
- Quá trình này cung cấp kinh nghiệm thực tế trong việc tái cấu trúc (refactoring) một dự án hiện có.
- Để tìm hiểu thêm, xem: [[Entity Framework Core]], [[Ngữ cảnh cơ sở dữ liệu (DB Context)]], [[Tái cấu trúc mã nguồn (Refactoring)]].

---

**Liên kết nội bộ gợi ý**:
- [[Entity Framework Core]]: Tìm hiểu cách sử dụng Entity Framework Core để quản lý cơ sở dữ liệu.
- [[Ngữ cảnh cơ sở dữ liệu (DB Context)]]: Hướng dẫn cấu hình và sử dụng DB Context.
- [[Tái cấu trúc mã nguồn (Refactoring)]]: Các kỹ thuật tổ chức lại mã nguồn để tăng tính mô-đun hóa.
- [[ASP.NET Core Project References]]: Cách thiết lập tham chiếu giữa các dự án trong một giải pháp.