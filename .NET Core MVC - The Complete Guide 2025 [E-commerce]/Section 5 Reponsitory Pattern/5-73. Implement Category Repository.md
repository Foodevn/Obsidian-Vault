##  Triển khai lớp CategoryRepository

### Giới thiệu
- Lớp `CategoryRepository` thực thi giao diện `ICategoryRepository` và kế thừa từ lớp generic `Repository<Category>` để tận dụng các phương thức CRUD cơ bản.
- Mục tiêu: Cung cấp triển khai cụ thể cho các phương thức `Update` và `Save`, đồng thời tái sử dụng các phương thức CRUD từ lớp cơ sở.

### Vị trí và cấu trúc
- **Vị trí**: Thư mục `Repository` trong dự án `Data`.
- **Tên lớp**: `CategoryRepository`.
- **Kế thừa**:
  - Lớp cơ sở: `Repository<Category>` (cung cấp các phương thức CRUD như `Add`, `GetAll`, `GetFirstOrDefault`, `Remove`, `RemoveRange`).
  - Giao diện: `ICategoryRepository` (định nghĩa các phương thức đặc thù như `Update`, `Save`).
- **Khai báo**:
  ```csharp
  public class CategoryRepository : Repository<Category>, ICategoryRepository
  ```

### Constructor và Dependency Injection
- **Mô tả**: 
  - Lớp sử dụng `ApplicationDbContext` để truy cập cơ sở dữ liệu.
  - `ApplicationDbContext` được tiêm qua **Dependency Injection** và truyền đến lớp cơ sở thông qua `base`.
- **Mã nguồn**:
  ```csharp
  private readonly ApplicationDbContext _db;

  public CategoryRepository(ApplicationDbContext db) : base(db)
  {
      _db = db;
  }
  ```
- **Giải thích**:
  - `db` được truyền vào constructor và chuyển đến lớp cơ sở để khởi tạo `_dbSet`.
  - Trường `_db` được lưu để sử dụng trong các phương thức `Update` và `Save`.

### Triển khai phương thức
#### Update
- **Mô tả**: Cập nhật thông tin của một đối tượng `Category` trong cơ sở dữ liệu.
- **Thực hiện**: Sử dụng `_db.Categories.Update(obj)` để đánh dấu đối tượng cần cập nhật.
- **Mã nguồn**:
  ```csharp
  public void Update(Category obj)
  {
      _db.Categories.Update(obj);
  }
  ```

#### Save
- **Mô tả**: Lưu các thay đổi vào cơ sở dữ liệu bằng `SaveChanges` của Entity Framework Core (EF Core).
- **Thực hiện**: Gọi `_db.SaveChanges()` để xác nhận các thay đổi.
- **Mã nguồn**:
  ```csharp
  public void Save()
  {
      _db.SaveChanges();
  }
  ```

### Mã nguồn đầy đủ
```csharp
using Bulky.DataAccess.Data;
using Bulky.DataAccess.Repository.IRepository;

namespace Bulky.DataAccess.Repository
{
    public class CategoryRepository : Repository<Category>, ICategoryRepository
    {
        private readonly ApplicationDbContext _db;

        public CategoryRepository(ApplicationDbContext db) : base(db)
        {
            _db = db;
        }

        public void Update(Category obj)
        {
            _db.Categories.Update(obj);
        }

        public void Save()
        {
            _db.SaveChanges();
        }
    }
}
```

### Ghi chú quan trọng
- **Kế thừa từ `Repository<Category>`**:
  - Các phương thức CRUD cơ bản (`Add`, `GetAll`, `GetFirstOrDefault`, `Remove`, `RemoveRange`) được tái sử dụng từ lớp cơ sở, giảm lặp mã nguồn.
- **Dependency Injection**:
  - `ApplicationDbContext` được tiêm vào để truy cập cơ sở dữ liệu.
  - Gọi `base(db)` đảm bảo `_dbSet` được khởi tạo đúng với loại `Category`.
- **Phương thức `Update`**:
  - Sử dụng `_db.Categories.Update(obj)` để rõ ràng về tập hợp `Categories`.
  - Thay đổi chỉ được lưu khi gọi phương thức `Save`.
- **Phương thức `Save`**:
  - Gọi `_db.SaveChanges()` để lưu tất cả thay đổi (thêm, xóa, cập nhật) vào cơ sở dữ liệu.

### Liên kết nội bộ
- [[IRepository]]: Xem chi tiết về giao diện generic và các phương thức CRUD.
- [[ICategoryRepository]]: Tìm hiểu giao diện đặc thù cho `Category`.
- [[Repository Pattern]]: Hiểu về mẫu thiết kế Repository.
- [[Entity Framework Core]]: Tham khảo các phương thức `Update`, `SaveChanges`.
- [[Dependency Injection]]: Tìm hiểu cách tiêm `ApplicationDbContext`.

### Kết luận
- Lớp `CategoryRepository` được triển khai hoàn chỉnh, kế thừa các phương thức CRUD và cung cấp triển khai cho `Update` và `Save`.
- Phần tiếp theo: Hướng dẫn thay thế `ApplicationDbContext` bằng `CategoryRepository` trong ứng dụng.