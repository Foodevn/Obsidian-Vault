## Các lệnh Docker Run và Thực hành

### Giới thiệu
- Bài giảng giới thiệu các lệnh `docker run` phổ biến và cách sử dụng chúng để chạy container.
- Cuối bài, học viên sẽ thực hành các lệnh này trong một bài tập thực tế [[Labs thực hành]].

### 1. Chỉ định phiên bản (Tag) cho Image
- **Khái niệm**:
  - Khi chạy container với lệnh `docker run <image>`, Docker mặc định sử dụng phiên bản mới nhất (tag `latest`).
  - Tag là cách chỉ định phiên bản cụ thể của một image, ví dụ: `redis:4.0` để chạy phiên bản Redis 4.0.
  - Nếu không chỉ định tag, Docker tự động kéo phiên bản `latest` do nhà phát triển phần mềm xác định.
- **Cách tra cứu thông tin phiên bản**:
  - Truy cập **Docker Hub** [[Docker Hub]] để xem danh sách các tag được hỗ trợ.
  - Mỗi phiên bản phần mềm có thể có nhiều tag ngắn hoặc dài, ví dụ: `redis:5.0.5` cũng có tag `latest`.
- **Ví dụ**:
  - Chạy Redis phiên bản mới nhất: `docker run redis`
  - Chạy Redis phiên bản 4.0: `docker run redis:4.0`

### 2. Chế độ tương tác (Interactive Mode)
- **Vấn đề**:
  - Khi chạy một ứng dụng yêu cầu nhập liệu (ví dụ: nhập tên để hiển thị thông báo chào mừng), container mặc định không nhận đầu vào từ người dùng (chạy ở chế độ không tương tác).
  - Container không tự động gắn với terminal để hiển thị prompt hoặc nhận đầu vào.
- **Giải pháp**:
  - Sử dụng tham số `-i` (interactive mode) để ánh xạ đầu vào chuẩn (standard input) từ host vào container.
  - Sử dụng tham số `-t` (pseudo-terminal) để gắn terminal của container.
  - Kết hợp `-i` và `-t`: `docker run -it <image>` để vừa gắn terminal vừa cho phép nhập liệu.
- **Ví dụ**:
  ```bash
  docker run -it kodekloud/simple-prompt-docker
  docker run kodeloud/webapp
  ```
  - Khi chạy, ứng dụng hiển thị prompt, nhận tên người dùng và in thông báo chào mừng.

### 3. Ánh xạ cổng (Port Mapping/Port Publishing)
- **Khái niệm**:
  - Ứng dụng trong container (ví dụ: web app) thường chạy trên một cổng cụ thể (port), ví dụ: 5000.
  - Để người dùng bên ngoài truy cập ứng dụng, cần ánh xạ cổng của container đến cổng trên **Docker host** (máy chủ cài Docker) [[Docker Host]].
- **Cách thực hiện**:
  - Sử dụng tham số `-p` để ánh xạ cổng: `-p <host-port>:<container-port>`.
  - Ví dụ: Ánh xạ cổng 80 trên host đến cổng 5000 trong container:
    ```bash
    docker run -p 80:5000 my-web-app
    ```
  - Người dùng truy cập ứng dụng qua: `http://<docker-host-ip>:80`.
- **Lưu ý**:
  - Mỗi container có địa chỉ IP nội bộ (internal IP), ví dụ: `172.17.0.2`, chỉ truy cập được từ bên trong Docker host.
  - Để truy cập từ bên ngoài, sử dụng IP của Docker host (ví dụ: `192.168.1.5`) và cổng đã ánh xạ.
  - Không thể ánh xạ cùng một cổng trên host cho nhiều container.
- **Ví dụ**:
  - Chạy MySQL container trên cổng mặc định 3306:
    ```bash
    docker run -p 3306:3306 mysql
    ```
  - Chạy instance khác của MySQL trên cổng 8306:
    ```bash
    docker run -p 8306:3306 mysql
    ```

### 4. Lưu trữ dữ liệu (Data Persistence)
- **Vấn đề**:
  - Container có hệ thống tệp biệt lập, dữ liệu (ví dụ: cơ sở dữ liệu MySQL) được lưu trong container (thư mục `/var/lib/mysql`).
  - Nếu container bị xóa, dữ liệu bên trong cũng bị mất.
- **Giải pháp**:
  - Sử dụng tham số `-v` để ánh xạ thư mục trên Docker host đến thư mục trong container: `-v <host-dir>:<container-dir>`.
  - Ví dụ: Ánh xạ thư mục `/opt/data` trên host đến `/var/lib/mysql` trong container:
    ```bash
    docker run -v /opt/data:/var/lib/mysql mysql
    ```
  - Dữ liệu sẽ được lưu trữ ngoài container, tại thư mục `/opt/data`, và tồn tại ngay cả khi container bị xóa.
- **Lợi ích**:
  - Dữ liệu được lưu trữ vĩnh viễn trên Docker host.
  - Có thể tái sử dụng dữ liệu cho các container mới.

### 5. Kiểm tra thông tin Container
- **Lệnh `docker ps`**:
  - Hiển thị thông tin cơ bản về container (tên, ID, trạng thái).
- **Lệnh `docker inspect`**:
  - Cung cấp thông tin chi tiết về container dưới dạng JSON, bao gồm trạng thái, cấu hình, dữ liệu, cài đặt mạng, v.v.
  - Cú pháp:
    ```bash
    docker inspect <container-name-or-id>
    ```
- **Ứng dụng**:
  - Sử dụng khi cần kiểm tra chi tiết cấu hình hoặc trạng thái của container.

### 6. Xem Logs của Container
- **Khái niệm**:
  - Khi chạy container ở chế độ nền (detached mode) với tham số `-d`, container không hiển thị đầu ra (logs) trực tiếp.
- **Lệnh `docker logs`**:
  - Hiển thị nội dung đầu ra chuẩn (standard output) của container.
  - Cú pháp:
    ```bash
    docker logs <container-name-or-id>
    ```
- **Ví dụ**:
  - Chạy web app ở chế độ nền:
    ```bash
    docker run -d my-web-app
    ```
  - Xem logs:
    ```bash
    docker logs my-web-app
    ```

### Ghi chú thêm
- **Liên kết chéo**:
  - [[Docker Hub]]: Nơi tra cứu thông tin image và tag.
  - [[Docker Host]]: Máy chủ cài đặt Docker.
  - [[Labs thực hành]]: Thực hành các lệnh `docker run` trong bài tập.
  - [[Networking]]: Tìm hiểu thêm về ánh xạ cổng và kết nối mạng trong bài giảng sau.
- **Hướng dẫn thực hành**:
  - Truy cập labs trên **Code Cloud** để thực hành các lệnh `docker run` [[Truy cập Labs trong Khóa học]].
  - Thử nghiệm các tham số `-i`, `-t`, `-p`, `-v`, và các lệnh `docker ps`, `docker inspect`, `docker logs`.

Chúc bạn thành công với bài tập thực hành!